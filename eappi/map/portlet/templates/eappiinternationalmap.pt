<dl class="portlet portletEappiInternationalMap"
    i18n:domain="eappi.map">

    <dt class="portletHeader">
        <span class="portletTopLeft"></span>
        Eappi International Map
        <span class="portletTopRight"></span>
    </dt>

    <dd class="portletItem">

    <div id="map" style="height: ${view/data/map_height}px"></div>            

                                                                                
<script type="text/javascript">                                                 
var bounds = new L.LatLngBounds(new L.LatLng(80.74,-159.26), new L.LatLng(-51.768,174.243));

var markers = <tal:block replace="structure view/data/map_marker"></tal:block>;

                                                              
var map = L.map( 'map', {                                                          
    center: [20.0, 5.0],                                                           
    worldCopyJump: true,
    minZoom: ${view/data/min_zoom},
    zoom: ${view/data/map_zoom},
    maxBounds: bounds,
    bounds: bounds

});                                                                                


//For later improvement
map.fitBounds(bounds);
                                                                                   
L.tileLayer( 'http://{s}.mqcdn.com/tiles/1.0.0/map/{z}/{x}/{y}.png', {             
    attribution: '&copy; <a href="http://osm.org/copyright" title="OpenStreetMap" target="_blank">OpenStreetMap</a> contributors | Tiles Courtesy of <a href="http://www.mapquest.com/" title="MapQuest" target="_blank">MapQuest</a> <img src="http://developer.mapquest.com/content/osm/mq_logo.png" width="16" height="16">',
    subdomains: ['otile1','otile2','otile3','otile4']                              
}).addTo( map );                                                                   
                                                                                   
var EappiMarkerOptions = {
    radius: ${view/data/marker_size},
    fillColor: "#ff7800",
    color: "#000",
    weight: 1,
    opacity: 1,
    fillOpacity: 0.8
};

for ( var i=0; i < markers.length; ++i )
{
   L.circleMarker( [markers[i].lat, markers[i].lng], EappiMarkerOptions )
       .bindPopup( '<h5>' + markers[i].title + '</h5>' + markers[i].body )
      .addTo( map );
}

</script>  

    </dd>

    <dd class="portletFooter">
        <span class="portletBottomLeft"></span>
        <span class="portletBottomRight"></span>
    </dd>

</dl>
